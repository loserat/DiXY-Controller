# Home Assistant Automations fÃ¼r DiXY RDWC
# Kopiere in ~/.homeassistant/automations/dixy_rdwc_automations.yaml

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AUTO DOSIERUNG: EC-NÃ¤hrstoff (alle 30 Min prÃ¼fen)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Auto Dosierung EC"
  description: "EC-HauptdÃ¼nger dosieren wenn zu niedrig (Pumpe A)"
  trigger:
    platform: time_pattern
    minutes: "/30"
  condition:
    - condition: numeric_state
      entity_id: sensor.hydroknoten_ec_wert
      below: 1.4  # input_number.ec_target (Standard 1.5, hier Hysterese)
    - condition: state
      entity_id: binary_sensor.dosierung_ruehrzeit_ok
      state: "on"
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.dosierung_pumpe_a
    - delay:
        seconds: 10
    - service: switch.turn_off
      target:
        entity_id: switch.dosierung_pumpe_a
    - service: notify.persistent_notification
      data:
        title: "âœ… DiXY EC Dosierung"
        message: "Pumpe A (EC) fÃ¼r 10s aktiviert. Neue EC: {{ states('sensor.hydroknoten_ec_wert') }} mS/cm"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AUTO DOSIERUNG: pH Correction (alle 30 Min)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Auto Dosierung pH"
  description: "pH Up/Down dosieren wenn auÃŸerhalb Range"
  trigger:
    platform: time_pattern
    minutes: "/30"
  condition:
    - condition: state
      entity_id: binary_sensor.dosierung_ruehrzeit_ok
      state: "on"
  action:
    - choose:
        # pH zu niedrig â†’ pH Up (Pumpe C)
        - conditions:
            - condition: numeric_state
              entity_id: sensor.hydroknoten_ph_wert
              below: 5.8
          sequence:
            - service: switch.turn_on
              target:
                entity_id: switch.dosierung_pumpe_c
            - delay:
                seconds: 5
            - service: switch.turn_off
              target:
                entity_id: switch.dosierung_pumpe_c
            - service: notify.persistent_notification
              data:
                title: "â¬†ï¸ DiXY pH UP"
                message: "Pumpe C aktiviert (pH {{ states('sensor.hydroknoten_ph_wert') }})"
        
        # pH zu hoch â†’ pH Down (Pumpe B)
        - conditions:
            - condition: numeric_state
              entity_id: sensor.hydroknoten_ph_wert
              above: 6.2
          sequence:
            - service: switch.turn_on
              target:
                entity_id: switch.dosierung_pumpe_b
            - delay:
                seconds: 5
            - service: switch.turn_off
              target:
                entity_id: switch.dosierung_pumpe_b
            - service: notify.persistent_notification
              data:
                title: "â¬‡ï¸ DiXY pH DOWN"
                message: "Pumpe B aktiviert (pH {{ states('sensor.hydroknoten_ph_wert') }})"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AUTO LÃœFTER: VPD-basierte Steuerung
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ LÃ¼fter Auto VPD"
  description: "Inline-LÃ¼fter basierend auf VPD + Temperatur"
  trigger:
    - platform: state
      entity_id: sensor.zeltsensor_vpd
    - platform: state
      entity_id: sensor.zeltsensor_lufttemperatur
  action:
    - service: number.set_value
      target:
        entity_id: number.dosierung_inline_luefter_pwm
      data:
        value: >
          {% set vpd = states('sensor.zeltsensor_vpd') | float(0) %}
          {% set air_temp = states('sensor.zeltsensor_lufttemperatur') | float(0) %}
          
          {# Temperatur-Override #}
          {% if air_temp > 28 %}
            {{ [((vpd - 0.4) / 0.8 * 100) | int(0), 50] | max }}
          {% elif air_temp > 32 %}
            100
          
          {# VPD-basiert #}
          {% elif vpd > 1.2 %}
            100
          {% elif vpd < 0.4 %}
            0
          {% else %}
            {{ ((vpd - 0.4) / 0.8 * 100) | int(0) }}
          {% endif %}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WARNUNG: EC/pH kritisch
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Alert EC/pH kritisch"
  description: "Benachrichtigung wenn EC/pH auÃŸerhalb Bereich"
  trigger:
    - platform: numeric_state
      entity_id: sensor.hydroknoten_ec_wert
      below: 0.8
    - platform: numeric_state
      entity_id: sensor.hydroknoten_ec_wert
      above: 2.5
    - platform: numeric_state
      entity_id: sensor.hydroknoten_ph_wert
      below: 5.5
    - platform: numeric_state
      entity_id: sensor.hydroknoten_ph_wert
      above: 7.0
  action:
    - service: notify.persistent_notification
      data:
        title: "âš ï¸ DiXY RDWC â€“ EC/pH ALARM"
        message: >
          EC: {{ states('sensor.hydroknoten_ec_wert') }} mS/cm
          pH: {{ states('sensor.hydroknoten_ph_wert') }} pH
          
          Handeln erforderlich!

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WARNUNG: Tank Leer
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Alert Tank leer"
  description: "Kritischer Alarm wenn Tank leer"
  trigger:
    platform: state
    entity_id: binary_sensor.hydroknoten_tank_leer
    to: "on"
  action:
    - service: notify.persistent_notification
      data:
        title: "ğŸš¨ TANK LEER!"
        message: "Mindestens einer der 6 Tanks ist leer. SOFORT NACHFÃœLLEN!"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WARNUNG: VPD kritisch
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Alert VPD kritisch"
  description: "Warnung wenn VPD < 0.4 (Schimmel) oder > 1.6 (Stress)"
  trigger:
    - platform: numeric_state
      entity_id: sensor.zeltsensor_vpd
      below: 0.4
    - platform: numeric_state
      entity_id: sensor.zeltsensor_vpd
      above: 1.6
  action:
    - service: notify.persistent_notification
      data:
        title: "âš ï¸ VPD KRITISCH"
        message: >
          VPD: {{ states('sensor.zeltsensor_vpd') }} kPa
          Lufttemp: {{ states('sensor.zeltsensor_lufttemperatur') }} Â°C
          RH: {{ states('sensor.zeltsensor_luftfeuchte') }} %
          
          LÃ¼fter/Befeuchter anpassen!

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SENSOR-FEHLER: ADS1115 (EC/pH ADC)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Health Alert ADS1115 Fehler"
  description: "Warnung wenn ADS1115 ADC Fehler"
  trigger:
    platform: state
    entity_id: binary_sensor.hydroknoten_ads1115_fehler
    to: "on"
  action:
    - service: notify.persistent_notification
      data:
        title: "ğŸ”´ ADS1115 Fehler"
        message: "EC/pH Sensor antwortet nicht! I2C-Kabel + Spannungsversorgung prÃ¼fen."

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DAILY RESET: Tages-Counter
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Daily Reset Counter"
  description: "Tages-Counter um 00:00 UTC zurÃ¼cksetzen"
  trigger:
    platform: time
    at: "00:00:00"
  action:
    - service: button.press
      target:
        entity_id: button.dosierung_daily_reset

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KAMERA: StÃ¼ndliche Canopy-Snapshots
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Canopy Snapshot Hourly"
  description: "StÃ¼ndliche Canopy-Snapshots fÃ¼r Timelapse"
  trigger:
    platform: time_pattern
    hours: "*"
    minutes: "0"
  action:
    - service: camera.snapshot
      target:
        entity_id: camera.canopy_camera
      data:
        filename: "/config/snapshots/canopy_{{ now().strftime('%Y%m%d_%H%M%S') }}.jpg"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KAMERA: 4x Daily Detail-Snapshots
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Detail Camera 4x Daily"
  description: "Detail-Snapshots um 08:00, 14:00, 20:00, 02:00"
  trigger:
    - platform: time
      at: "08:00:00"
    - platform: time
      at: "14:00:00"
    - platform: time
      at: "20:00:00"
    - platform: time
      at: "02:00:00"
  action:
    - service: camera.snapshot
      target:
        entity_id: camera.detail_camera
      data:
        filename: "/config/snapshots/detail_{{ now().strftime('%Y%m%d_%H%M%S') }}.jpg"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TIMELAPSE: StÃ¼ndliche Canopy-Snapshots
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "Timelapse: StÃ¼ndliche Canopy-Snapshots"
  description: "Erstellt jede Stunde ein Canopy-Foto fÃ¼r Timelapse"
  trigger:
    - platform: time_pattern
      hours: "/1"
  action:
    - service: camera.snapshot
      target:
        entity_id: camera.kameraknoten_canopy
      data:
        filename: /config/www/timelapse/canopy/{{ now().strftime('%Y%m%d_%H%M%S') }}_canopy.jpg

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TIMELAPSE: Detail-Snapshot 08:00
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "Timelapse: Detail-Snapshot 08:00"
  trigger:
    - platform: time
      at: "08:00:00"
  action:
    - service: camera.snapshot
      target:
        entity_id: camera.kameraknoten_detail
      data:
        filename: /config/www/timelapse/detail/{{ now().strftime('%Y%m%d') }}_0800_detail.jpg

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TIMELAPSE: Detail-Snapshot 14:00
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "Timelapse: Detail-Snapshot 14:00"
  trigger:
    - platform: time
      at: "14:00:00"
  action:
    - service: camera.snapshot
      target:
        entity_id: camera.kameraknoten_detail
      data:
        filename: /config/www/timelapse/detail/{{ now().strftime('%Y%m%d') }}_1400_detail.jpg

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TIMELAPSE: Detail-Snapshot 20:00
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "Timelapse: Detail-Snapshot 20:00"
  trigger:
    - platform: time
      at: "20:00:00"
  action:
    - service: camera.snapshot
      target:
        entity_id: camera.kameraknoten_detail
      data:
        filename: /config/www/timelapse/detail/{{ now().strftime('%Y%m%d') }}_2000_detail.jpg

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TIMELAPSE: Monatliches Cleanup (30+ Tage alte Fotos)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "Timelapse: Monatliches Cleanup"
  description: "LÃ¶scht Fotos Ã¤lter als 30 Tage am 1. des Monats"
  trigger:
    - platform: time
      at: "03:00:00"
  condition:
    - condition: template
      value_template: "{{ now().day == 1 }}"
  action:
    - service: notify.persistent_notification
      data:
        title: "ğŸ—‘ï¸ Timelapse Cleanup"
        message: "Monatliches Cleanup lÃ¤uft. Fotos Ã¤lter als 30 Tage werden gelÃ¶scht."


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TIMELAPSE: Manuelle Snapshots
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "Timelapse: Manueller Canopy-Snapshot"
  description: "Manueller Canopy-Snapshot via Trigger"
  trigger:
    - platform: state
      entity_id: input_boolean.manual_canopy_snapshot
      to: "on"
  action:
    - service: camera.snapshot
      target:
        entity_id: camera.kameraknoten_canopy
      data:
        filename: /config/www/timelapse/canopy/manual_{{ now().strftime('%Y%m%d_%H%M%S') }}_canopy.jpg
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.manual_canopy_snapshot

- alias: "Timelapse: Manueller Detail-Snapshot"
  description: "Manueller Detail-Snapshot via Trigger"
  trigger:
    - platform: state
      entity_id: input_boolean.manual_detail_snapshot
      to: "on"
  action:
    - service: camera.snapshot
      target:
        entity_id: camera.kameraknoten_detail
      data:
        filename: /config/www/timelapse/detail/manual_{{ now().strftime('%Y%m%d_%H%M%S') }}_detail.jpg
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.manual_detail_snapshot

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LIGHT CONTROL: MANUAL MODE â€“ ON
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Licht Manuell EIN"
  description: "Schaltet Licht ein basierend auf Manuell-Zeit"
  trigger:
    - platform: time
      at: input_datetime.light_manual_on_time
  condition:
    - condition: state
      entity_id: input_select.light_mode
      state: "Manuell"
  action:
    - service: script.fade_light_smooth
      data:
        target_intensity: "{{ states('input_number.light_manual_intensity') | int(default=80) }}"
        fade_duration: "{{ states('input_number.light_fade_duration') | int(default=60) }}"
    - service: notify.persistent_notification
      data:
        title: "ğŸ’¡ DiXY Licht (Manuell)"
        message: "Licht eingeschaltet: {{ (states('input_number.light_manual_intensity') | int(default=80)) }}%"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LIGHT CONTROL: MANUAL MODE â€“ OFF
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Licht Manuell AUS"
  description: "Schaltet Licht aus basierend auf Manuell-Zeit"
  trigger:
    - platform: time
      at: input_datetime.light_manual_off_time
  condition:
    - condition: state
      entity_id: input_select.light_mode
      state: "Manuell"
  action:
    - service: script.fade_light_smooth
      data:
        target_intensity: 0
        fade_duration: "{{ states('input_number.light_fade_duration') | int(default=60) }}"
    - service: notify.persistent_notification
      data:
        title: "ğŸ’¡ DiXY Licht (Manuell)"
        message: "Licht ausgeschaltet"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LIGHT CONTROL: AUTO MODE â€“ SUNRISE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Licht Auto SONNENAUFGANG"
  description: "Licht fade-in bei Sonnenaufgang (mit Offset)"
  trigger:
    - platform: sun
      event: sunrise
      offset: "00:{{ '%02d' | format((states('input_number.light_auto_sunrise_offset') | int(default=-30)) % 60) }}:00"
  condition:
    - condition: state
      entity_id: input_select.light_mode
      state: "Auto (Sonnenauf-/untergang)"
  action:
    - service: script.fade_light_smooth
      data:
        target_intensity: 100
        fade_duration: "{{ states('input_number.light_fade_duration') | int(default=60) }}"
    - service: notify.persistent_notification
      data:
        title: "ğŸŒ… DiXY Licht Auto"
        message: "Licht fade-in: Sonnenaufgang {{ (states('input_number.light_auto_sunrise_offset') | int(default=-30)) }} Minuten"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LIGHT CONTROL: AUTO MODE â€“ SUNSET
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Licht Auto SONNENUNTERGANG"
  description: "Licht fade-out bei Sonnenuntergang (mit Offset)"
  trigger:
    - platform: sun
      event: sunset
      offset: "00:{{ '%02d' | format((states('input_number.light_auto_sunset_offset') | int(default=30)) % 60) }}:00"
  condition:
    - condition: state
      entity_id: input_select.light_mode
      state: "Auto (Sonnenauf-/untergang)"
  action:
    - service: script.fade_light_smooth
      data:
        target_intensity: 0
        fade_duration: "{{ states('input_number.light_fade_duration') | int(default=60) }}"
    - service: notify.persistent_notification
      data:
        title: "ğŸŒ… DiXY Licht Auto"
        message: "Licht fade-out: Sonnenuntergang {{ (states('input_number.light_auto_sunset_offset') | int(default=30)) }} Minuten"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LIGHT CONTROL: PPFD MODE â€“ CONTINUOUS REGULATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Licht PPFD Regelung"
  description: "Kontinuierliche PPFD-basierte Licht-Anpassung"
  trigger:
    - platform: state
      entity_id: sensor.zeltsensor_ppfd
  condition:
    - condition: state
      entity_id: input_select.light_mode
      state: "PPFD-Regelung"
  action:
    - service: script.adjust_light_ppfd
    - service: notify.persistent_notification
      data:
        title: "ğŸ“Š DiXY PPFD Regelung"
        message: "PPFD: {{ states('sensor.zeltsensor_ppfd') }} â†’ Licht: {{ states('number.dosierung_inline_luefter_pwm') }}%"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LIGHT CONTROL: TEMPERATURE FAILSAFE (Priority!)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- alias: "DiXY â€“ Licht NOTBREMSE Temperatur"
  description: "Schaltet Licht auf 10% wenn Temp > 30Â°C (alle Modi)"
  trigger:
    - platform: state
      entity_id: sensor.zeltsensor_lufttemperatur
  condition:
    - condition: numeric_state
      entity_id: sensor.zeltsensor_lufttemperatur
      above: 30
  action:
    - service: number.set_value
      target:
        entity_id: number.zeltsensor_v2_light_intensity
      data:
        value: 10
    - service: notify.persistent_notification
      data:
        title: "ğŸ”´ DiXY LICHT NOTBREMSE"
        message: "Temperatur > 30Â°C! Licht auf 10% reduziert. Aktuelle Temp: {{ states('sensor.zeltsensor_lufttemperatur') }}Â°C"

